# 2020Q2
## 2020.03.10-2020.03.13
1. 注册了各个网站(OA, Ehr, It, Mail, ubuntu)并修改密码，半天
2. 浏览自动驾驶DPC的Confluence，半天
3. 查看PP的相关界面，半天
4. 按照新员工操作练习任务一配置环境，一天半(https://confluence.sensetime.com/pages/viewpage.action?pageId=101900275)
   1. 权限添加：获得了gerrit.sensetime.com权限，加入了ADR&D邮件组，获得了senseauto_binary_release的公共aws key
   2. 配置二进制开发系统环境
   3. 配置git lfs账号
   4. 下载senseauto代码以及配置gerrit和repo
   5. 部署docker环境，在docker环境下完成程序的编译链接
   6. 问题：
      1. 权限未获取:找leader和zhangshu分别获取权限，并完成aws的配置(不然无法下载二进制编译数据)
      2. repo拉取文件错误:可能是因为git lfs版本未更新至最新
      3. cmake failure:主机代码未更新至最新
5. 参与登科和升发关于NBO障碍物筛选的讨论 半天
6. 了解并运行rviz模拟器，配置vpn(身体原因远程办公) 半天
## 2020.03.16
1. 学习git操作，并且完成练习， 半天
2. 每周例会， 半天
3. 学习如何使用rosrun plotjuggler和tmux来仿真
## 2020.03.17
1. 学习Vim和tmux
2. 阅读代码：
   1. 变量
   2. 文件
## 2020.03.18
1. 学习git的操作
2. 阅读并运行代码
   1. baseplanner, planner, dp_searcher,st_graph_searcher, longi_lat_planner
## 2020.03.19
1. 阅读代码
   1. predict_map, object_screen, longi_lat_planner剩余的函数
## 2020.03.20
1. 阅读代码
   1. parser， obstacle_map
2. 学习Linux技巧
## 2020.03.23
1. 阅读代码
* Init: Base_planner::Create_planner, Longi_lat_planner::Init, Parser::Init, Object_map::Init, Predict_map::Init
* Update: Base_planner::Update, Base_planner::BuildFrenetCoordSystem
* Update: Longi_lat_planner::Plan, Parser::Update, Object_map::Update, Predict_map::Update
* Update: Predict_map::Refresh, Object_map::FindNBO, Object_map::ConstructSIntervals
* Update: Longi_lat_planner::UpdateCachedPath
2. 开会(下午周例会， 晚上会议)
## 2020.03.24
1. 阅读代码
* Update：Longi_lat_palnner::UpdateInitState, DPSearcher::Update, DPSearcher::Search
* Update: Longi_lat_planner::LongitudinalOptimize, Longi_lat_planner::LateralOptimize
* Update: Longi_lat_planner::EmergencyBrake, Longi_lat_planner::ApplyFallBack
2. 查看config参数及confluence
## 2020.03.25
1. 仿真(HMI和Ros PlotJuggler)
2. 仿真bag和场景编辑，OKR小组讨论
## 2020.03.26
1. 仿真HMI以及场景编辑器
2. aws路测数据下载
3. 仿真调试流程熟悉
## 2020.03.27
1. 仿真场景打tag
2. 分析场景
3. 阅读代码

## 2020.03.30
1. 周会
2. 0327仿真场景打tag
3. 阅读代码
## 2020.03.31
1. 阅读谷歌代码规范
2. 整理pp代码思路
3. 分析0330数据

## 2020.04.01
1. 整理规划dqq
2. 分析0331数据
## 2020.04.02
1. Q2OKR会议
2. Q2OKR整理
3. 阅读OMP
## 2020.04.03
1. 阅读OMP
2. Q2OKR整理
3. cut in思路整理

## 2020.04.07
1. Q2OKR整理
2. 缓慢cut in confluence思路
## 2020.04.08
1. 障碍物筛选整理
2. 障碍物筛选case梳理
3. 分析0402数据
## 2020.04.09
1. 障碍物筛选代码
2. 回流case
3. 学习repo，新建分支
4. 缓慢cutin讨论
## 2020.04.10
1. 缓慢cut in代码编写
2. 回放case
3. 组会分享

## 2020.04.13
1. 障碍物筛选(对于大车来说label只有在回放的时候才有，在本地仿真的时候就没有)
2. 整理障碍物筛选相关case()
3. 提交代码到gerrit
4. 提交路测
## 2020.04.14
1. 整理cut in的case
2. 安装clang format 3.8
3. 编写cut in代码
4. daily test会议
## 2020.04.15
1. 修复变道障碍物筛选的issue
2. 编写cut in代码
3. 用每个case来测试obs分支
4. 发现障碍物筛选的bug并提交路测
## 2020.04.16
1. 修改不同obs代码
2. 测试每个障碍物筛选的case
3. 发现可视化HMI bug
## 2020.04.17
1. 分析路测数据
2. 完善缓慢cut in情况
3. 周报分析

## 2020.04.20
1. 周报，合入代码
2. 修改cut in逻辑
3. 学习C++
## 2020.04.21
1. 完成cut in代码
2. 进行多组仿真测试
## 2020.04.22
1. 完成cut in代码测试
2. PP工具设计思路整理
## 2020.04.23
1. 分析路测数据
2. 仿真数据分析
3. 读OMP代码

## 2020.04.27
1. 合入cut in代码
2. 组会4个小时
## 2020.04.28
1. 合入代码
2. 修改nbo限速有关以及逻辑
## 2020.04.29
1. 搬家
## 2020.04.30
1. 修改nbo限速逻辑

## 2020.05.06
1. 修改nbo限速逻辑以及仿真
2. 周报以及任务整理

## 2020.05.07
1. PP代码整理
2. 看障碍物筛选以及一两个case
## 2020.05.08
## 2020.05.09
1. 分析case
2. 合如nbo限速
3. 增加hmi degug
4. 阅读sqp方法

## 2020.05.11
1. 周会
2. PP debug信息设计
## 2020.05.12
1. PP debug设计代码提交
2. dm2.5红绿灯逻辑修复
## 2020.05.13
1. PP debug设计代码修复
2. 红绿灯刹车逻辑
## 2020.05.14
1. 阅读SQP代码，改善速度规划
## 2020.05.15
1. Issue整理
2. 测试红绿灯刹车逻辑

## 2020.05.18
1. 周会整理
2. 修改SQP代码，尽量将刹车合入master
## 2020.05.19
1. 调试刹车参数
2. 修改SQP代码，并且调试
## 2020.05.20
1. 合入刹车代码
2. 整理sqp改进思路,不确定性的处理
## 2020.05.21
1. 整理路测case
2. cut in数据分析
3. 不确定性处理，完成代码
## 2020.05.22
1. 不确定性处理，进行测试
2. 解决QP存在的问题
3. 障碍物筛选的问题

## 2020.05.25
1. 修改qp不确定性代码，进行测试
2. 分析路口cut in以及新问题
## 2020.05.26
1. 分析路测问题，进行统计
2. qp不确定性代码及测试(4345, 4834, 4883, 4619)
3. qp速度参考的问题(4846)
3. cut in阈值分为缓慢cut in和紧急cut in(4958, 4880)
## 2020.05.27
1. 分析路测问题
2. 测试cut in参数(已提交)
3. 解决他车近距离导致的无解问题(思考)
## 2020.05.28
1. 阅读代码(障碍物筛选，纵向优化边界，横向优化边界，求解失败，障碍物投影，变道过程)
## 2020.05.29
1. 阅读代码并且分析Q2 daily test

## 2020.06.01
1. 阅读代码，分析路测case
## 2020.06.02
1. 阅读代码，分析路测

## 2020.06.08
1. 分析路测case
2. 开会以及制定本周计划
3. 分析路测case 更新dqq v1.0
## 2020.06.09
1. 分析路测case 更新dqq v1.0
2. 阅读代码，看qp仿真结果
## 2020.06.10
1. 更新dqq v1.0
2. 分析紧急cut in的case
3. 完成代码阅读以及障碍物筛选
## 2020.06.11
1. 阅读代码以及障碍物筛选(完成)
## 2020.06.12
1. 合入qp不确定性
2. 分析问题，阅读代码
3. 统计dqq v1.0

# 2020Q3
## 2020.06.30
1. HdMap2.0 PP代码适配
## 2020.07.01
1. HdMap2.0 代码适配
2. 前车急刹自车安全性分析
3. 路测数据分析
4. Hdmap2.0开发
## 2020.07.02
1. 急刹数据分析
2. OKR整理
3. 删除High V
## 2020.07.03
1. 安装黑苹果，并且学习苹果系统的使用

## 2020.07.06
1. 合入删除high v场景
2. 分析接管数据
## 2020.07.07
1. 解决加速过猛的问题
2. 设计s ref线型和cost
## 2020.07.08
1. 整理路测case，与dqq2.0
2. 解决high v的bug
## 2020.07.09
1. 整理急刹车case
2. 跟科哥修复了一个bug
## 2020.07.10
1. merge场景分析
2. merge方案设计

## 2020.07.13
1. 开会
2. 分析接管问题，新建5676，5677两个Issue，5676定义为自行车预测轨迹速度不对，交给ap；5657定义为两个问题一个是进入fall back出现的bug，另一个是跟前车的时候，stop distance 2m之后自车误启动
## 2020.07.14
1. 5677(无法复现)，5702（待合入）
2. 急刹车问题分析
3. 第三方库更新，好麻烦
## 2020.07.15
1. 第三方库更新5484，通过CI
2. 5702发现问题，修复待合入
3. 整理接管类case，更新dqq
4. 5434，开路测会议
## 2020.07.16
1. 合入5702
2. 大进展-前车cut in减速之后急加速问题修复(发现衰减系数很重要)
3. 下午和晚上搞定了停止线，准备接下来做一下pp规划的轨迹跟颜色有关的改进
## 2020.07.17
1. 修改5741在hmi上面画出8s的pp轨迹
2. 强行抢道和merge

## 2020.07.20
1. 三个前车急刹case的仿真和分析
2. 上周有几个事情(1.修复纵向5702的bug，并且定位5766和5767关于纵向接管的问题；2.调跟车的参数，现在基本上比较接近红绿灯跟车的参数，减速效果也能从jerk-6到-3，除此之外感觉做的比较好的是解决通过优化SQP的线型以及设计cost的曲线来解决他车cut in之后急加速的问题(现在master之后的)5434， 5484；3.纵向安全性，我仿真了几个比较极端的工况，发现了几个结论；一个就是AP收敛速度变慢，至少比6月底那个时候慢了一些，其次在比较急的减速的时候比较容易触发实际更新；还有就是低速的时候减速度会变小，有点怪。4.优化了pp停止线的显示和pp规划线(停止线现在不会出现左右乱摆的问题，规划线是分成四段每段两秒))
3. 前车急刹方案的设计

## 2020.07.21

1. 前车静止，自车制动距离分析
2. 左转待转区，自车无法减速问题分析

## 2020.07.22

1. 分析接管数据，更新dqqv1.0
2. 分析急刹数据
3. 修改前车急刹车的一些结论
4. 找collision的bug
5. 预测轨迹加速度不对的问题找孙刚和邱聪
6. 编辑case

## 2020.07.23

1. 开会(紧急场景的case)
2. 建仿真的case(急刹车紧急场景)
3. 找红绿灯的bug

## 2020.07.24
1. 合如修复急刹车的bug
2. 创建merge他车，弯道被cut in，自车直行他车右拐，他车直行自车右拐，横穿等几个case
3. 仿真这几个case，确定紧急场景的参数
4. 标准测试场景

## 2020.07.27

1. 准备开会方面的事情(上周主要在做纵向安全性实验的仿真，完成紧急场景定义跟在一些典型场景下的仿真，顺便建了几个典型场景放到标准场景测试里面路口merge他车的，被cut in，自车直行他车右拐，横穿，定位了几个问题(仿真预测没加速度，跟车或者红绿灯溜车，纵向无解后不刹车浪费制动距离，待转区无减速的问题))
2. 本周计划(1.完成纵向硬件在环的安全性实验，与仿真结果对比 2.跟军哥一起解决溜车问题 3.纵向舒适度优化，跟车无顿感)

## 2020.07.28

1. 上午定位了前车尺寸跳动的问题，因为前车尤其是大车的polygon有跳动，给的中心位置比较准确
2. 分析急刹车的问题，(不在本车道内，错误当成前车进行刹车, 5859)，体验一圈master
3. 体验变道

## 2020.07.29

1. 急刹数据整理，帮忙分析纵向不走的问题
2. 优化fall back
3. 进行仿真放到5632

## 2020.07.30

1. 检查leader s是不是到车尾
2. 配置环境
3. 纵向检查是否是权重的问题（第三方库的问题）
4. 更新第三方库代码
5. 上车测试缓解急刹车的代码

## 2020.07.31

1. 测试纵向不走的问题，并何如代码
2. 测试他车急刹的代码
3. 整理急刹车场景和思路

## 2020.07月总结

1. 
   对非紧急场景的 纵向舒适度进行优化，删除High V场景，调节纵向跟车舒适度，优化跟高速前车的权重和cost的设计
2. 优化fallback逻辑，减少他车在持续部分压线的情况下的刹车，减少5m外cut in带来的刹车
3. 路测问题持续梳理(包括急刹车和接管问题)
4. 完成纵向安全性实验(仿真部分)和紧急场景的定义优化

接手纵向模块代码以来，主要关注在纵向舒适度的提高，通过在临港的亲身体验，我认为现在非紧急场景下纵向跟车是比较舒服的。除了纵向跟车场景，也着重花时间解决了近距离cut in和部分压线情况下的急刹车问题。近距离cut in fallback优化的问题。**安全性和舒适性会有一定的矛盾**

随着路测测试里程的持续提高(从以前的700多到现在的接近2000)，PP模块的性能得到不断的检验，但与此同时每周的case数目也会很多，总体来说这个路测问题的梳理就会比以前要花费更多时间。而且很多时候定位到别的模块的问题，比如前段时间定位到LOD尺寸不对，AP自行车速度异常，这一定程度也增加了我们模块的精力消耗。

Lowlight：**矫枉过正，平衡点比较难找，按下葫芦浮起瓢**，改完一个bug，又会多出来一个bug.测试不够充分，很多时候是怕delay，所以简单测一下场景，然后跑两三圈就合了(而且很多时候路侧安排的是在晚上测试，测试无效的就比较多)

Meeting Note: 问题定位清楚(不能只打补丁，要解决就解决一类问题，时间久一点就久一点）（提高测试的效率）

提高时间效率(可以每天固定一个小时看一下case进行统计)，（每天晚上定一下第二天的任务）（周五来定下周任务和本周总结）

上周主要工作有两个

## 2020.08.03 

1. 周会与1 on 1 meeting
2. 看0729路测数据
3. HIL测试(测不到实车，会变道)

## 2020.08.04

1. 急刹的case的分析(30,31)
2. 测试了一圈o2l(HIL不行)
3. fall back逻辑整理

## 2020.08.06

1. 定位到fusion第一帧跟bbox不一样的问题
2. 修改pp轨迹宽度
3. fall back 25m 减速度

## 2020.08.07

1. 修改fallback，完成代码和仿真测试

## 2020.08.10

上周优化了一版fallback，主要期望解决两个问题(一个是现在master进入fallback初始条件无解，第二个是fallback导致溜车)，思路是在求解失败后将碰撞点作为停止点，并且持续维护这个停止点(帧与帧之间更新最小停止点的距离，求解成功重置停止点位置)，现在仿真基本完成，等待路测，本周合入(checkcollision)

上周利用HIL测试了六组纵向安全性实验，得到几个结论(执行器加控制延时0.2-0.3s之间，其次实车实验和仿真得到的制动距离均在22-23m，评估了现在车辆在紧急情况下的体验。在上游模块200-300ms延时的情况下能够处理10m前车急刹的紧急场景。这一块未完成工作是对上游模块提出延时需求

解决merge场景下两个问题(障碍物筛选以及纵向避让不足的问题)

1. fallback的优化，仿真测试	

## 2020.08.13

1. 找到fallback的一个bug，定位了两三天(卡在了两个bug)
2. 整理急刹车的case

## 2020.08.17

1. 提交fallback代码
2. 可视化纵向优化
3. 解决时间靠后的障碍物减速不足的问题

我上周主要是在测fallback优化，这一块应该比较delay，主要原因是更新到横向dp之后，遇到了两个bug(一个是box2d初始化的问题，第二个是障碍物第0帧polygon不对的问题)，这块路测完已经合入master，应该能减少一部分急刹车

除此之外上周主要关注纵向刹车力度不够的问题(主要有几个原因，1.考虑车道宽度更窄导致避让时间更晚 2.现在纵向对时间比较靠后的障碍物避让力度不够 3.前车轨迹延时比较大)

在测试的时候也发现(现在主要原因收到障碍物的延时过大)，还有就是发现横穿或者时间比较靠后的障碍物力度不足

## 2020.08.19

1. 可视化纵向优化
2. fallback bug修复
3. 尝试用纵向dp结果进行qp优化

## 2020.08.20

1. 合入可视化
2. 纵向优化

## 2020.08.24

上周主要做了两件事情一个是纵向优化过程可视化代码编写，大概花了一到两天的时间，这一部分已经合到了master。另一部分主要是在优化纵向存在的几个问题：一个是在较远处车辆刹车较弱(Cross和Merge场景)，绕行车辆时减速限速不足，被与本车车速接近的车辆cut in时减速有点大

上周主要做了这几个方面的尝试，得到的结果还算不错。

现在merge他车应该还差障碍物筛选这块的工作

1. Merge case

## 2020.08.25

1. 登科测试
2. merge场景
3. 仿真case（60%急刹车能通过）

## 2020.08.27

1. 路测数据分析(15.54.50,15:59:51,16:04:05,16:13:31)
2. 远距离启动
3. 整理优化s线型，测试了六圈lga，一圈o2l，仿真平台
4. 修复fallback bug

## 2020.08.28

1. 急刹车数据
2. 测试fallback和线型
3. 障碍物筛选讨论

## 2020.08.31

1. 查看6264的数据，修复横向求解失败纵向不刹车的问题，提交ci，通过仿真平台

2. 查看6041数据，今天要合入

   1. 现在很慢的原因1. 仿真log case跑不起来，很难回放问题。 2. 仿真平台会有问题，验证很慢。

   仿真比较慢，本地case跟平台不一样

3. 上周主要完成两个工作，一个是测试了横穿车辆避让不足的6041，测了6圈LGA一圈O2L+，应该没遇到什么比较大的问题，然后本来预计上周合入，现在有一些delay，主要卡在了仿真(两个问题吧，一个是仿真平台跑的跟本地不太一样，第二个是仿真比较耗时)，第二个工作是修复了横向求解失败纵向不减速的问题，现在完成了路测，也是卡在了仿真。

4. 检查case

## 2020.09.01

1. 合入6264
2. 检查障碍物筛选

## 2020.09.02

1. 修改6041，前车v = 0的时候s的权重为1，前车速度高的时候权重为0.33
2. 修改5373
3. 复现前车nan的问题(0场景和bin都复现不了)，直接造了个case前车直接为1000，给个sqrt(-1)

## 2020.09.03

1. 新建急刹车issue
2. 分类数据

## 2020.09.04

1. 修改了第三方库的修改方式，之后第三方库不需要每次都发版(docker 更新镜像， 编写脚本)

## 2020.09.07

1. 上周一个任务是合入纵向线型优化，这块现在的进展是修改了PP第三方库的更新方式，现在是准备走路测流程(问题1 make install找不到生成的文件)， 另一部分任务是障碍物筛选完成方案，路测待合入
2. make install找翀哥帮忙
3. issuecase分析

## 2020.09.08

1. 分析issue
2. make install让翀哥搞定
3. 障碍物筛选本地仿真搞定

## 2020.09.09

1. Make install数据分析
2. 5号急刹车数据
3. 障碍物筛选对nudge, 后方来车

## 2020.09.10

1. 过ci，合入make install
2. 测试障碍物筛选
3. 跟车

## 2020.09.11

1. 障碍物筛选数据分析
2. polygon尺寸
3. 跟车的仿真和ci